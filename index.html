<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Γραφικά - Εργασία Κύβος Ρούμπικ</title>
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>

    <style>
      /* Menu controls */
      #rubiks-menu {
        position: absolute;
        top: 18px;
        right: 18px;
        z-index: 10;
        background: rgba(255, 255, 255, 0.92);
        padding: 12px 14px;
        border-radius: 10px;
        font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
        box-shadow: 0 8px 18px rgba(0, 0, 0, 0.12);
        user-select: none;
      }
      #rubiks-menu .grid {
        display: grid;
        grid-template-columns: repeat(4, auto);
        gap: 8px;
        margin-top: 8px;
      }
      #rubiks-menu button {
        padding: 8px 10px;
        border-radius: 10px;
        border: none;
        background: #2196f3;
        color: #fff;
        cursor: pointer;
        font-weight: 700;
      }
      #rubiks-menu button:hover {
        background: #1976d2;
      }
      #rubiks-menu button.secondary {
        background: #455a64;
      }
      #rubiks-menu button.secondary:hover {
        background: #37474f;
      }
      #rubiks-menu small {
        color: #333;
        display: block;
        margin-top: 10px;
        line-height: 1.25;
      }
    </style>
  </head>

  <body>
    <div id="rubiks-menu">
      <b>Έλεγχος Κύβου</b>
      <div class="grid">
        <button onclick="move('U')">U</button>
        <button onclick="move('Uprime')">U'</button>
        <button onclick="move('D')">D</button>
        <button onclick="move('Dprime')">D'</button>

        <button onclick="move('L')">L</button>
        <button onclick="move('Lprime')">L'</button>
        <button onclick="move('R')">R</button>
        <button onclick="move('Rprime')">R'</button>

        <button onclick="move('F')">F</button>
        <button onclick="move('Fprime')">F'</button>
        <button onclick="move('B')">B</button>
        <button onclick="move('Bprime')">B'</button>
      </div>

      <div style="margin-top: 10px; display: flex; gap: 10px">
        <button class="secondary" onclick="scramble(20)">Scramble</button>
        <button class="secondary" onclick="resetCube()">Reset</button>
      </div>

      <small>
        Keyboard: U D L R F B<br />
        Shift = αντίστροφη (π.χ. Shift+U → U')
      </small>
    </div>

    <a-scene stats>
      <a-assets>
        <img
          id="skyTexture"
          src="https://kostasgian21.github.io/computer_graphics/360-degree_Panorama_of_the_Southern_Sky.jpg"
          crossorigin="anonymous"
        />
        <!--
        -->

        <a-asset-item id="tinkercad-model" src="tinkercad_model.glb"></a-asset-item>

      </a-assets>

      <a-sky src="#skyTexture"></a-sky>

      <!-- Lights -->
      <a-entity light="type: ambient; intensity: 1.1; color: #FFF"></a-entity>
      <a-entity
        light="type: directional; intensity: 2.2; color: #FFF"
        position="2 5 2"
      ></a-entity>
      <a-entity
        light="type: point; intensity: 1.2; distance: 18; color: #B3E5FC"
        position="-3 2.2 -1.5"
      ></a-entity>

     <a-entity
     text="value: MICHALIS; align: center; width: 6; color: #FF5722; side: double"
     position="0 3.2 -2.2"
     rotation="0 0 0">
     </a-entity>

<!-- Extra cubes για την Ερώτηση 4 
<a-entity id="extra-cubes">
  <a-box position="-4 1.2 -3" depth="0.8" height="0.8" width="0.8" color="#4CC3D9"></a-box>
  <a-box position="-3 1.2 -3" depth="0.8" height="0.8" width="0.8" color="#FFC65D"></a-box>
  <a-box position="-2 1.2 -3" depth="0.8" height="0.8" width="0.8" color="#7BC8A4"></a-box>
  <a-box position="-1 1.2 -3" depth="0.8" height="0.8" width="0.8" color="#F16745"></a-box>
  <a-box position="0  1.2 -3" depth="0.8" height="0.8" width="0.8" color="#93648D"></a-box>
</a-entity>
-->


<!-- Tinkercad model  -->
<a-entity
  id="tinkercad-object"
  gltf-model="#tinkercad-model"
  position="0 1.3 -3"
  rotation="0 45 0"
  scale="12 12 12"
</a-entity>







      <a-plane
        rotation="-90 0 0"
        position="0 0 -3"
        width="12"
        height="12"
        color="#111"
      ></a-plane>

      <a-entity id="cube-cluster" visible="false"></a-entity>
      <a-entity id="decorations"></a-entity>

      <a-entity
        camera
        look-controls
        wasd-controls="fly: true"
        position="0 1.7 1.9"
      ></a-entity>
    </a-scene>




    <script>
      const cluster = document.getElementById("cube-cluster");
      const deco = document.getElementById("decorations");

      const SPACING = 0.72;
      const CUBELET_SIZE = 0.62;

      const STICKER_SIZE = 0.50;
      const STICKER_OFFSET = CUBELET_SIZE / 2 + 0.006;

      const Y_OFFSET = 1.2;
      const Z_OFFSET = -3;

      const ANIM_MS = 220;

      let busy = false;
      const queue = [];

      const coords = [-1, 0, 1];
      const cubelets = [];
      const initial = [];

      function gridToWorld(x, y, z) {
        return {
          x: x * SPACING,
          y: y * SPACING + Y_OFFSET,
          z: z * SPACING + Z_OFFSET,
        };
      }

      function applyWorldPosition(c) {
        const x = +c.dataset.x;
        const y = +c.dataset.y;
        const z = +c.dataset.z;
        const w = gridToWorld(x, y, z);
        c.setAttribute("position", `${w.x} ${w.y} ${w.z}`);
      }

      const COLORS = {
        U: "#FFFFFF",
        D: "#FFD500",
        F: "#00A651",
        B: "#0047FF",
        R: "#FF3B30",
        L: "#FF9500",
      };

      function makeSticker(color, position, rotation) {
        const p = document.createElement("a-plane");
        p.setAttribute("width", STICKER_SIZE);
        p.setAttribute("height", STICKER_SIZE);
        p.setAttribute("color", color);
        p.setAttribute("position", position);
        p.setAttribute("rotation", rotation);
        p.setAttribute("material", "shader: standard; metalness: 0.05; roughness: 0.35;");
        return p;
      }

      function buildCubelet(x, y, z) {
        const c = document.createElement("a-entity");
        c.dataset.x = x;
        c.dataset.y = y;
        c.dataset.z = z;

        const body = document.createElement("a-box");
        body.setAttribute("width", CUBELET_SIZE);
        body.setAttribute("height", CUBELET_SIZE);
        body.setAttribute("depth", CUBELET_SIZE);
        body.setAttribute("color", "#111");
        body.setAttribute("material", "shader: standard; metalness: 0.0; roughness: 0.85;");
        c.appendChild(body);

        if (y === 1) c.appendChild(makeSticker(COLORS.U, `0 ${STICKER_OFFSET} 0`, `-90 0 0`));
        if (y === -1) c.appendChild(makeSticker(COLORS.D, `0 ${-STICKER_OFFSET} 0`, `90 0 0`));

        if (z === 1) c.appendChild(makeSticker(COLORS.F, `0 0 ${STICKER_OFFSET}`, `0 0 0`));
        if (z === -1) c.appendChild(makeSticker(COLORS.B, `0 0 ${-STICKER_OFFSET}`, `0 180 0`));

        if (x === 1) c.appendChild(makeSticker(COLORS.R, `${STICKER_OFFSET} 0 0`, `0 -90 0`));
        if (x === -1) c.appendChild(makeSticker(COLORS.L, `${-STICKER_OFFSET} 0 0`, `0 90 0`));

        applyWorldPosition(c);
        return c;
      }

      for (const y of coords) {
        for (const x of coords) {
          for (const z of coords) {
            const c = buildCubelet(x, y, z);
            cluster.appendChild(c);
            cubelets.push(c);
            initial.push({ x, y, z });
          }
        }
      }

      const pedestal = document.createElement("a-cylinder");
      pedestal.setAttribute("position", `0 0.18 ${Z_OFFSET}`);
      pedestal.setAttribute("radius", "1.65");
      pedestal.setAttribute("height", "0.36");
      pedestal.setAttribute("color", "#263238");
      pedestal.setAttribute("material", "shader: standard; metalness: 0.1; roughness: 0.6;");
      deco.appendChild(pedestal);

      const pillars = [
        [-4.8, -7.8],
        [4.8, -7.8],
        [-4.8, 1.8],
        [4.8, 1.8],
      ];
      pillars.forEach(([px, pz], i) => {
        const col = document.createElement("a-cylinder");
        col.setAttribute("position", `${px} 1.2 ${pz}`);
        col.setAttribute("radius", "0.18");
        col.setAttribute("height", "2.4");
        col.setAttribute("color", i % 2 ? "#546E7A" : "#607D8B");
        col.setAttribute("material", "shader: standard; metalness: 0.05; roughness: 0.75;");
        deco.appendChild(col);

        const cap = document.createElement("a-box");
        cap.setAttribute("position", `${px} 2.45 ${pz}`);
        cap.setAttribute("width", "0.55");
        cap.setAttribute("height", "0.12");
        cap.setAttribute("depth", "0.55");
        cap.setAttribute("color", "#90A4AE");
        deco.appendChild(cap);
      });

      const ring = document.createElement("a-torus");
      ring.setAttribute("position", `0 1.2 ${Z_OFFSET}`);
      ring.setAttribute("radius", "2.15");
      ring.setAttribute("radius-tubular", "0.05");
      ring.setAttribute("rotation", "90 0 0");
      ring.setAttribute("color", "#00BCD4");
      ring.setAttribute("material", "shader: standard; metalness: 0.2; roughness: 0.35;");
      ring.setAttribute("animation", "property: rotation; to: 90 360 0; dur: 12000; loop: true; easing: linear");
      deco.appendChild(ring);

      const FLOAT_N = 16;
      for (let i = 0; i < FLOAT_N; i++) {
        const type = i % 3 === 0 ? "a-sphere" : i % 3 === 1 ? "a-box" : "a-cone";
        const el = document.createElement(type);

        const s = 0.22 + Math.random() * 0.22;
        el.setAttribute("scale", `${s} ${s} ${s}`);

        const angle = (i / FLOAT_N) * Math.PI * 2;
        const radius = 3.2 + Math.random() * 1.1;

        const px = Math.cos(angle) * radius;
        const pz = Z_OFFSET + Math.sin(angle) * radius;
        const py = 0.6 + Math.random() * 2.4;

        el.setAttribute("position", `${px} ${py} ${pz}`);

        const color = i % 2 ? "#FFEB3B" : "#4CAF50";
        el.setAttribute("color", color);
        el.setAttribute("material", "shader: standard; metalness: 0.05; roughness: 0.55;");

        const up = py + 0.25 + Math.random() * 0.25;
        const dur = 1600 + Math.floor(Math.random() * 1800);

        el.setAttribute(
          "animation__float",
          `property: position; dir: alternate; dur: ${dur}; loop: true; easing: easeInOutSine; to: ${px} ${up} ${pz}`
        );

        el.setAttribute(
          "animation__spin",
          `property: rotation; to: ${Math.random() * 360} ${Math.random() * 360} ${Math.random() * 360}; dur: ${7000 + Math.floor(Math.random() * 6000)}; loop: true; easing: linear`
        );

        deco.appendChild(el);
      }

      const defs = {
        U:      { axis: "y", layer: +1, dir: +1 },
        Uprime: { axis: "y", layer: +1, dir: -1 },
        D:      { axis: "y", layer: -1, dir: -1 },
        Dprime: { axis: "y", layer: -1, dir: +1 },

        L:      { axis: "x", layer: -1, dir: -1 },
        Lprime: { axis: "x", layer: -1, dir: +1 },
        R:      { axis: "x", layer: +1, dir: +1 },
        Rprime: { axis: "x", layer: +1, dir: -1 },

        F:      { axis: "z", layer: -1, dir: +1 },
        Fprime: { axis: "z", layer: -1, dir: -1 },
        B:      { axis: "z", layer: +1, dir: -1 },
        Bprime: { axis: "z", layer: +1, dir: +1 },
      };

      function inLayer(c, axis, layer) {
        if (axis === "x") return +c.dataset.x === layer;
        if (axis === "y") return +c.dataset.y === layer;
        return +c.dataset.z === layer;
      }

      function rotateGrid(x, y, z, axis, dir) {
        if (axis === "y") return { x: -dir * z, y, z: dir * x };
        if (axis === "x") return { x, y: -dir * z, z: dir * y };
        return { x: -dir * y, y: dir * x, z };
      }

      function doMove(face) {
        const def = defs[face];
        if (!def) return;

        const affected = cubelets.filter((c) => inLayer(c, def.axis, def.layer));
        if (!affected.length) return;

        const pivot = document.createElement("a-entity");
        let cx = 0, cy = 0, cz = 0;
        if (def.axis === "x") cx = def.layer;
        if (def.axis === "y") cy = def.layer;
        if (def.axis === "z") cz = def.layer;

        const w = gridToWorld(cx, cy, cz);
        pivot.setAttribute("position", `${w.x} ${w.y} ${w.z}`);
        pivot.setAttribute("rotation", "0 0 0");
        cluster.appendChild(pivot);

        const pivotObj = pivot.object3D;
        affected.forEach((c) => pivotObj.attach(c.object3D));

        const rot = { x: 0, y: 0, z: 0 };
        rot[def.axis] = 90 * def.dir;

        pivot.setAttribute("animation__rot", {
          property: "rotation",
          to: `${rot.x} ${rot.y} ${rot.z}`,
          dur: ANIM_MS,
          easing: "easeInOutQuad",
        });

        pivot.addEventListener(
          "animationcomplete__rot",
          () => {
            const clObj = cluster.object3D;
            affected.forEach((c) => clObj.attach(c.object3D));

            affected.forEach((c) => {
              const x = +c.dataset.x;
              const y = +c.dataset.y;
              const z = +c.dataset.z;
              const r = rotateGrid(x, y, z, def.axis, def.dir);
              c.dataset.x = r.x;
              c.dataset.y = r.y;
              c.dataset.z = r.z;
            });

            affected.forEach(applyWorldPosition);
            pivot.remove();

            busy = false;
            if (queue.length) doMove(queue.shift());
          },
          { once: true }
        );
      }

      window.move = function (face) {
        if (busy) {
          queue.push(face);
          return;
        }
        busy = true;
        doMove(face);
      };

      window.scramble = function (n = 20) {
        const keys = Object.keys(defs);
        for (let i = 0; i < n; i++) {
          const k = keys[Math.floor(Math.random() * keys.length)];
          window.move(k);
        }
      };

      window.resetCube = function () {
        queue.length = 0;
        busy = false;
        cubelets.forEach((c, i) => {
          c.dataset.x = initial[i].x;
          c.dataset.y = initial[i].y;
          c.dataset.z = initial[i].z;
          applyWorldPosition(c);
          c.setAttribute("rotation", "0 0 0");
          c.object3D.rotation.set(0, 0, 0);
        });
      };

      window.addEventListener("keydown", (e) => {
        const tag = (document.activeElement && document.activeElement.tagName) || "";
        if (tag === "INPUT" || tag === "TEXTAREA") return;

        const map = { KeyU: "U", KeyD: "D", KeyL: "L", KeyR: "R", KeyF: "F", KeyB: "B" };
        const k = map[e.code];
        if (!k) return;

        const face = e.shiftKey ? k + "prime" : k;
        window.move(face);
        e.preventDefault();
      });
    </script>
  </body>
</html>
